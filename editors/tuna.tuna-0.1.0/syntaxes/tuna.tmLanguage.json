{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "TunaScript",
  "scopeName": "source.tuna",
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#sql-block" },
    { "include": "#table-definition" },
    { "include": "#numbers" },
    { "include": "#keywords" },
    { "include": "#types" },
    { "include": "#constants" },
    { "include": "#functions" },
    { "include": "#jsx-tag" },
    { "include": "#operators" },
    { "include": "#punctuation" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.tuna",
          "match": "//.*$"
        },
        {
          "name": "comment.block.tuna",
          "begin": "/\\*",
          "end": "\\*/"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.template.tuna",
          "begin": "`",
          "end": "`",
          "patterns": [
            {
              "name": "constant.character.escape.tuna",
              "match": "\\\\."
            },
            { "include": "#template-interpolation" }
          ]
        },
        {
          "name": "string.quoted.double.tuna",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.tuna",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "template-interpolation": {
      "patterns": [
        {
          "name": "meta.embedded.expression.template.tuna",
          "begin": "(\\$\\{)",
          "beginCaptures": {
            "1": { "name": "punctuation.section.embedded.begin.tuna" }
          },
          "end": "(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.section.embedded.end.tuna" }
          },
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#keywords" },
            { "include": "#constants" },
            { "include": "#operators" },
            { "include": "#punctuation" },
            {
              "name": "variable.other.readwrite.tuna",
              "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.number.tuna",
          "match": "\\b[0-9]+\\.[0-9]+([eE][+-]?[0-9]+)?\\b"
        },
        {
          "name": "constant.numeric.integer.tuna",
          "match": "\\b[0-9]+\\b"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.tuna",
          "match": "\\b(if|else|for|of|return|switch|case|default|as)\\b"
        },
        {
          "name": "keyword.declaration.tuna",
          "match": "\\b(const|extern|function|export|import|from|create_table|type)\\b"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "comment": "Type name after 'type' keyword in import or after colon",
          "match": "(?<=type\\s)([A-Z][a-zA-Z0-9]*)",
          "captures": {
            "1": { "name": "entity.name.type.tuna" }
          }
        },
        {
          "comment": "Type annotation after colon - capitalized type names",
          "match": "(?<=:\\s*)([A-Z][a-zA-Z0-9]*)",
          "captures": {
            "1": { "name": "entity.name.type.tuna" }
          }
        },
        {
          "comment": "Type annotation after closing paren and colon - return types",
          "match": "(?<=\\):\\s*)([A-Z][a-zA-Z0-9]*)",
          "captures": {
            "1": { "name": "entity.name.type.tuna" }
          }
        },
        {
          "name": "support.type.primitive.tuna",
          "match": "\\b(i64|i32|number|boolean|string|json|void)\\b"
        },
        {
          "name": "storage.type.tuna",
          "match": "\\b(INTEGER|TEXT|REAL|BLOB|PRIMARY|KEY|AUTOINCREMENT|NOT|NULL|DEFAULT|CURRENT_TIMESTAMP)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.boolean.tuna",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "constant.language.null.tuna",
          "match": "\\b(null|undefined)\\b"
        }
      ]
    },
    "jsx-tag": {
      "patterns": [
        {
          "comment": "Self-closing JSX tag: <tagname ... />",
          "name": "meta.tag.jsx.tuna",
          "begin": "(<)([A-Za-z][a-zA-Z0-9]*)(?=\\s|/?>)",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.jsx.tuna" },
            "2": { "name": "entity.name.tag.jsx.tuna" }
          },
          "end": "(/?>)",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.end.jsx.tuna" }
          },
          "patterns": [{ "include": "#jsx-tag-attributes" }]
        },
        {
          "comment": "Closing JSX tag: </tagname>",
          "name": "meta.tag.jsx.tuna",
          "match": "(</?)([A-Za-z][a-zA-Z0-9]*)(>)",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.jsx.tuna" },
            "2": { "name": "entity.name.tag.jsx.tuna" },
            "3": { "name": "punctuation.definition.tag.end.jsx.tuna" }
          }
        },
        {
          "comment": "JSX expression in content: {expr}",
          "name": "meta.embedded.expression.jsx.tuna",
          "begin": "(\\{)(?=[^}]*\\})",
          "beginCaptures": {
            "1": { "name": "punctuation.section.embedded.begin.jsx.tuna" }
          },
          "end": "(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.section.embedded.end.jsx.tuna" }
          },
          "patterns": [
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#constants" },
            {
              "name": "variable.other.readwrite.jsx.tuna",
              "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
            }
          ]
        }
      ]
    },
    "jsx-tag-attributes": {
      "patterns": [
        {
          "comment": "Attribute with string value: attr=\"value\"",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_-]*)\\s*(=)\\s*(\"[^\"]*\"|'[^']*')",
          "captures": {
            "1": { "name": "entity.other.attribute-name.jsx.tuna" },
            "2": { "name": "punctuation.separator.key-value.jsx.tuna" },
            "3": { "name": "string.quoted.jsx.tuna" }
          }
        },
        {
          "comment": "Attribute with expression: attr={expr}",
          "begin": "\\b([a-zA-Z_][a-zA-Z0-9_-]*)\\s*(=)\\s*(\\{)",
          "beginCaptures": {
            "1": { "name": "entity.other.attribute-name.jsx.tuna" },
            "2": { "name": "punctuation.separator.key-value.jsx.tuna" },
            "3": { "name": "punctuation.section.embedded.begin.jsx.tuna" }
          },
          "end": "(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.section.embedded.end.jsx.tuna" }
          },
          "patterns": [
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#constants" },
            {
              "name": "variable.other.readwrite.jsx.tuna",
              "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
            }
          ]
        },
        {
          "comment": "Boolean attribute: attr",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_-]*)\\b(?!=)",
          "captures": {
            "1": { "name": "entity.other.attribute-name.jsx.tuna" }
          }
        }
      ]
    },
    "sql-block": {
      "patterns": [
        {
          "begin": "(execute|fetch_optional|fetch_one|fetch_all|fetch)(\\s*)(\\{)",
          "beginCaptures": {
            "1": { "name": "keyword.other.sql.tuna" },
            "2": { "name": "source.tuna" },
            "3": { "name": "punctuation.section.block.begin.sql.tuna" }
          },
          "end": "(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.section.block.end.sql.tuna" }
          },
          "contentName": "meta.embedded.block.sql.tuna",
          "patterns": [
            { "include": "#sql-interpolation" },
            { "include": "#sql-keywords" },
            { "include": "#strings" },
            { "include": "#numbers" }
          ]
        }
      ]
    },
    "sql-interpolation": {
      "match": "(\\{)([a-zA-Z_][a-zA-Z0-9_]*)(\\})",
      "captures": {
        "1": { "name": "punctuation.section.interpolation.begin.tuna" },
        "2": { "name": "variable.other.tuna" },
        "3": { "name": "punctuation.section.interpolation.end.tuna" }
      }
    },
    "sql-keywords": {
      "patterns": [
        {
          "name": "keyword.other.dml.sql.tuna",
          "match": "\\b(SELECT|select|INSERT|insert|UPDATE|update|DELETE|delete|FROM|from|WHERE|where|INTO|into|VALUES|values|SET|set|ORDER|order|BY|by|GROUP|group|HAVING|having|LIMIT|limit|OFFSET|offset|JOIN|join|LEFT|left|RIGHT|right|INNER|inner|OUTER|outer|ON|on|AND|and|OR|or|AS|as|DISTINCT|distinct|ALL|all|CREATE|create|TABLE|table|DROP|drop|ALTER|alter|INDEX|index|PRIMARY|primary|KEY|key|FOREIGN|foreign|REFERENCES|references|AUTOINCREMENT|autoincrement|NOT|not|NULL|null|DEFAULT|default|CURRENT_TIMESTAMP|INTEGER|integer|TEXT|text|REAL|real|BLOB|blob|last_insert_rowid)\\b"
        }
      ]
    },
    "table-definition": {
      "patterns": [
        {
          "name": "meta.table.tuna",
          "begin": "\\b(create_table)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\{",
          "beginCaptures": {
            "1": { "name": "keyword.declaration.tuna" },
            "2": { "name": "entity.name.type.table.tuna" }
          },
          "end": "\\}",
          "patterns": [
            {
              "name": "storage.type.tuna",
              "match": "\\b(INTEGER|TEXT|REAL|BLOB|PRIMARY|KEY|AUTOINCREMENT|NOT|NULL|DEFAULT|CURRENT_TIMESTAMP|FOREIGN|REFERENCES)\\b"
            },
            { "include": "#comments" },
            {
              "name": "variable.other.column.tuna",
              "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
            },
            { "include": "#punctuation" }
          ]
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "meta.function.tuna",
          "match": "\\b(function)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(",
          "captures": {
            "1": { "name": "keyword.declaration.tuna" },
            "2": { "name": "entity.name.function.tuna" }
          }
        },
        {
          "name": "entity.name.function.call.tuna",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\()"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.tuna",
          "match": "(==|!=|<=|>=|<|>)"
        },
        {
          "name": "keyword.operator.arithmetic.tuna",
          "match": "(\\+|\\-|\\*|\\/|%)"
        },
        {
          "name": "keyword.operator.logical.tuna",
          "match": "(&|\\|)"
        },
        {
          "name": "keyword.operator.assignment.tuna",
          "match": "="
        },
        {
          "name": "keyword.operator.arrow.tuna",
          "match": "=>"
        },
        {
          "name": "keyword.operator.spread.tuna",
          "match": "\\.\\.\\."
        },
        {
          "name": "keyword.operator.result.tuna",
          "match": "\\?"
        }
      ]
    },
    "punctuation": {
      "patterns": [
        {
          "name": "punctuation.separator.comma.tuna",
          "match": ","
        },
        {
          "name": "punctuation.terminator.statement.tuna",
          "match": ";"
        },
        {
          "name": "punctuation.separator.colon.tuna",
          "match": ":"
        },
        {
          "name": "punctuation.accessor.tuna",
          "match": "\\."
        },
        {
          "name": "punctuation.definition.bracket.round.tuna",
          "match": "[()]"
        },
        {
          "name": "punctuation.definition.bracket.square.tuna",
          "match": "[\\[\\]]"
        },
        {
          "name": "punctuation.definition.bracket.curly.tuna",
          "match": "[{}]"
        }
      ]
    }
  }
}
