// expect: error
// expect: $.age: missing field

import { log, type Error } from "prelude"
import { parse, decode } from "json"

type Person = { name: string, age: number }

export function main(): void {
  const parsed = parse("{\"name\":\"Alice\"}")
  switch (parsed) {
    case err as Error: {
      log("error")
      log(err.message)
    }
    case j as json: {
      const decoded = decode<Person>(j)
      switch (decoded) {
        case decoded as Error: {
          log("error")
          log(decoded.message)
        }
        case decoded as Person: {
          log("ok")
        }
      }
    }
  }
}
