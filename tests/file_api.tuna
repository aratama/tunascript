// expect: missing
// expect: write_ok
// expect: exists
// expect: hello
// expect: append_ok
// expect: hello world
// expect: dir_ok
// expect: missing_read_error

import { log } from "prelude"
import { read_text, write_text, append_text, read_dir, exists } from "file"
import { filter, length } from "array"

const filename: string = "file_api_test.txt"
const missing: string = "file_api_missing.txt"

export function main(): void {
  if (exists(missing)) {
    log("missing_exists")
  } else {
    log("missing")
  }

  const writeRes: undefined | error = write_text(filename, "hello")
  switch (writeRes) {
    case _ as undefined: {
      log("write_ok")
    }
    case err as error: {
      log("write_error")
      log(err.message)
    }
  }

  if (exists(filename)) {
    log("exists")
  } else {
    log("not_exists")
  }

  const readRes: string | error = read_text(filename)
  switch (readRes) {
    case text as string: {
      log(text)
    }
    case err as error: {
      log("read_error")
      log(err.message)
    }
  }

  const appendRes: undefined | error = append_text(filename, " world")
  switch (appendRes) {
    case _ as undefined: {
      log("append_ok")
    }
    case err as error: {
      log("append_error")
      log(err.message)
    }
  }

  const readRes2: string | error = read_text(filename)
  switch (readRes2) {
    case text as string: {
      log(text)
    }
    case err as error: {
      log("read2_error")
      log(err.message)
    }
  }

  const dirRes: string[] | error = read_dir(".")
  switch (dirRes) {
    case entries as string[]: {
      const matches = filter(entries, function (name: string): boolean {
        return name == filename
      })
      if (length(matches) > 0) {
        log("dir_ok")
      } else {
        log("dir_missing")
      }
    }
    case err as error: {
      log("dir_error")
      log(err.message)
    }
  }

  const missingRead: string | error = read_text(missing)
  switch (missingRead) {
    case _ as string: {
      log("missing_read_unexpected")
    }
    case _ as error: {
      log("missing_read_error")
    }
  }
}
