// expect: ok
// expect: undefined
// expect: {}

import { log } from "prelude"
import { stringify, parse, decode } from "json"

type Person = { name: string | undefined }

export function main(): void {
  const parsed = parse("{}")
  switch (parsed) {
    case err as error: {
      log("error")
      log(err.message)
    }
    case j as json: {
      const decoded = decode<Person>(j)
      switch (decoded) {
        case decoded as error: {
          log("error")
          log(decoded.message)
        }
        case decoded as Person: {
          log("ok")
          const name = decoded.name
          const nameStr = switch (name) {
            case name as undefined: "undefined"
            case name as string: name
          }
          log(nameStr)
          log(stringify(decoded))
        }
      }
    }
  }
}
